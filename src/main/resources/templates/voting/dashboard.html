<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.w3.org/1999/xhtml"
      layout:decorate="~{layout}">

<head>
    <title>Voting Management - Dashboard</title>
    <style>
        .voting-dashboard { padding: 20px 0; }
        .voting-card { background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .voting-header { display: flex; align-items: center; margin-bottom: 25px; }
        .voting-icon { width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2em; margin-right: 20px; }
        .voting-title h2 { margin: 0; color: #333; font-size: 1.8em; }
        .voting-title p { margin: 5px 0 0 0; color: #666; }
        .stations-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
        .station-card { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 25px; text-align: center; transition: all 0.3s; cursor: pointer; }
        .station-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .station-card.eng { border-color: #1E40AF; }
        .station-card.eng:hover { background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%); }
        .station-card.it { border-color: #059669; }
        .station-card.it:hover { background: linear-gradient(135deg, rgba(5, 150, 105, 0.05) 0%, rgba(16, 185, 129, 0.05) 100%); }
        .station-card.bm { border-color: #DC2626; }
        .station-card.bm:hover { background: linear-gradient(135deg, rgba(220, 38, 38, 0.05) 0%, rgba(239, 68, 68, 0.05) 100%); }
        .station-card.as { border-color: #7C3AED; }
        .station-card.as:hover { background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(167, 139, 250, 0.05) 100%); }
        .station-icon { width: 70px; height: 70px; margin: 0 auto 15px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2em; color: white; }
        .station-card.eng .station-icon { background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); }
        .station-card.it .station-icon { background: linear-gradient(135deg, #059669 0%, #10B981 100%); }
        .station-card.bm .station-icon { background: linear-gradient(135deg, #DC2626 0%, #EF4444 100%); }
        .station-card.as .station-icon { background: linear-gradient(135deg, #7C3AED 0%, #A78BFA 100%); }
        .station-name { font-size: 1.3em; font-weight: 600; color: #333; margin-bottom: 5px; }
        .station-code { color: #999; font-size: 0.9em; margin-bottom: 15px; }
        .station-actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-operator { flex: 1; padding: 10px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em; transition: all 0.3s; }
        .btn-operator:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(17, 153, 142, 0.3); }
        .btn-tablet { flex: 1; padding: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em; transition: all 0.3s; }
        .btn-tablet:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
        .info-section { background: #f8f9fa; border-left: 4px solid #667eea; padding: 20px; margin-top: 30px; border-radius: 8px; }
        .info-section h4 { color: #333; margin-bottom: 15px; }
        .info-section ul { color: #666; line-height: 1.8; padding-left: 20px; }
        .quick-actions { display: flex; gap: 15px; margin-top: 20px; }
        .quick-action-btn { flex: 1; padding: 15px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 1em; transition: all 0.3s; }
        .btn-pin-entry { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-pin-entry:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4); }
        .btn-all-tablets { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .btn-all-tablets:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4); }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="voting-dashboard">
        <div class="voting-card">
            <div class="voting-header">
                <div class="voting-icon">üó≥Ô∏è</div>
                <div class="voting-title">
                    <h2>University Voting System</h2>
                    <p>Manage voting stations for student elections</p>
                </div>
            </div>

            <div class="quick-actions">
                <button class="quick-action-btn btn-pin-entry" onclick="openPinEntry()">
                    üîê Open PIN Entry & Station Selection
                </button>
            </div>

            <div class="stations-grid">
                <div class="station-card eng">
                    <div class="station-icon">üîß</div>
                    <div class="station-name">Engineering</div>
                    <div class="station-code">Station Code: ENG</div>
                    <div class="station-actions">
                        <button class="btn-operator" onclick="openOperator('ENG')">
                            üë§ Operator
                        </button>
                        <button class="btn-tablet" onclick="openTablet('ENG')">
                            üì± Tablet
                        </button>
                    </div>
                </div>

                <div class="station-card it">
                    <div class="station-icon">üíª</div>
                    <div class="station-name">Information Technology</div>
                    <div class="station-code">Station Code: IT</div>
                    <div class="station-actions">
                        <button class="btn-operator" onclick="openOperator('IT')">
                            üë§ Operator
                        </button>
                        <button class="btn-tablet" onclick="openTablet('IT')">
                            üì± Tablet
                        </button>
                    </div>
                </div>

                <div class="station-card bm">
                    <div class="station-icon">üíº</div>
                    <div class="station-name">Business Management</div>
                    <div class="station-code">Station Code: BM</div>
                    <div class="station-actions">
                        <button class="btn-operator" onclick="openOperator('BM')">
                            üë§ Operator
                        </button>
                        <button class="btn-tablet" onclick="openTablet('BM')">
                            üì± Tablet
                        </button>
                    </div>
                </div>

                <div class="station-card as">
                    <div class="station-icon">üî¨</div>
                    <div class="station-name">Applied Sciences</div>
                    <div class="station-code">Station Code: AS</div>
                    <div class="station-actions">
                        <button class="btn-operator" onclick="openOperator('AS')">
                            üë§ Operator
                        </button>
                        <button class="btn-tablet" onclick="openTablet('AS')">
                            üì± Tablet
                        </button>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h4>üìã Setup Instructions:</h4>
                <ul>
                    <li><strong>Quick Start:</strong> Click "Open PIN Entry" to start the voting process</li>
                    <li><strong>Operator Device:</strong> Click "üë§ Operator" button for each faculty to open operator interface</li>
                    <li><strong>Student Tablet:</strong> Click "üì± Tablet" button to open student voting interface on tablet</li>
                    <li><strong>Two-Device Setup:</strong> Each station needs 2 devices (1 operator laptop + 1 student tablet)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function openPinEntry() {
            window.open('/voting/', '_blank');
        }

        function openOperator(stationId) {
            // 1. Prompt the user for the PIN
            const pin = prompt('Enter voting PIN to access operator station:');

            if (!pin) {
                return; // User cancelled
            }

            // 2. Send PIN to backend for validation via AJAX (Secure)
            const formData = new URLSearchParams();
            formData.append('pin', pin);

            fetch('/voting/validate-pin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 3. If backend says valid, open the window
                        // The backend has now authorized this session
                        window.open('/voting/operator/' + stationId, '_blank');
                    } else {
                        alert('Invalid PIN! Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Connection error. Please try again.');
                });
        }

        function openTablet(stationId) {
            window.open('/voting/tablet/' + stationId, '_blank');
        }
    </script>
</div>
</body>
</html>