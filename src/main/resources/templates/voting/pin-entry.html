<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting System - PIN Entry</title>
    <link rel="stylesheet" th:href="@{/css/voting/pin-entry.css}">
</head>
<body>
<div class="container">
    <div class="lock-icon">ðŸ”’</div>
    <h1>University Voting System</h1>
    <p class="subtitle">Enter PIN to unlock voting station</p>

    <div class="pin-input-container">
        <input type="password" id="pinInput" placeholder="Enter PIN" maxlength="10" autofocus>
    </div>

    <button class="btn" onclick="validatePin()">Unlock</button>

    <div class="message" id="message"></div>
</div>

<script>
    document.getElementById('pinInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            validatePin();
        }
    });

    async function validatePin() {
        const pin = document.getElementById('pinInput').value.trim();
        const messageDiv = document.getElementById('message');

        if (!pin) {
            showMessage('Please enter a PIN', 'error');
            return;
        }

        try {
            const formData = new URLSearchParams();
            formData.append('pin', pin);

            const response = await fetch('/voting/validate-pin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                showMessage('PIN validated! Redirecting...', 'success');
                setTimeout(() => {
                    window.location.href = '/voting/station-selection';
                }, 1000);
            } else {
                showMessage(data.message, 'error');
                document.getElementById('pinInput').value = '';
                document.getElementById('pinInput').focus();
            }
        } catch (error) {
            showMessage('Error validating PIN', 'error');
            console.error(error);
        }
    }

    function showMessage(text, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = text;
        messageDiv.className = 'message ' + type;
        messageDiv.style.display = 'block';
    }
</script>
</body>
</html>